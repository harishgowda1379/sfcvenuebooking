<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Faculty Dashboard - College Venue Booking</title>
<style>

:root {
  --primary-dark: #1a237e; /* Dark blue */
  --primary-medium: #303f9f; /* Medium blue */
  --primary-light: #7986cb; /* Light blue */
  --accent-color: #7b1fa2; /* Purple accent */
  --accent-light: #9c27b0; /* Light purple */
  --text-dark: #212121;
  --text-light: #757575;
  --background: #ffffff;
  --card-bg: #f8f9fa;
  --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  --border-radius: 12px;
  --success: #4caf50;
  --warning: #ff9800;
  --error: #f44336;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
  color: var(--text-dark);
  line-height: 1.6;
  min-height: 100vh;
}

header {
  background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-medium) 100%);
  color: white;
  padding: 16px 5%;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.header-title {
  font-size: 1.5rem;
  font-weight: 600;
  letter-spacing: 0.5px;
}

.user-nav {
  display: flex;
  gap: 20px;
  align-items: center;
}

.user-nav a {
  color: white;
  text-decoration: none;
  font-weight: 500;
  padding: 8px 16px;
  border-radius: 6px;
  transition: all 0.3s ease;
  position: relative;
}

.user-nav a:hover {
  background: rgba(255, 255, 255, 0.15);
}

.user-nav a::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 50%;
  width: 0;
  height: 2px;
  background: white;
  transition: all 0.3s ease;
  transform: translateX(-50%);
}

.user-nav a:hover::after {
  width: 70%;
}

.container {
  max-width: 1100px;
  margin: 30px auto;
  padding: 0 20px;
}

.card {
  background: var(--background);
  padding: 30px;
  border-radius: var(--border-radius);
  box-shadow: var(--shadow);
  margin-bottom: 30px;
  border: 1px solid rgba(0, 0, 0, 0.05);
}

.title {
  font-size: 1.8rem;
  color: var(--primary-dark);
  margin-bottom: 20px;
  font-weight: 600;
  text-align: center;
}

.subtitle {
  font-size: 1.2rem;
  color: var(--primary-medium);
  margin: 20px 0 10px;
  font-weight: 600;
}

.booking-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
  flex-wrap: wrap;
  gap: 15px;
}

.nav-link {
  color: var(--accent-color);
  text-decoration: none;
  font-weight: 600;
  padding: 8px 16px;
  border-radius: 6px;
  border: 1px solid var(--accent-light);
  transition: all 0.3s ease;
}

.nav-link:hover {
  background: var(--accent-color);
  color: white;
}

label {
  display: block;
  margin-top: 20px;
  margin-bottom: 8px;
  font-weight: 600;
  color: var(--text-dark);
}

select, input {
  width: 100%;
  padding: 12px 15px;
  margin-top: 5px;
  border-radius: 8px;
  border: 1px solid #ddd;
  font-size: 1rem;
  transition: all 0.3s ease;
  background: white;
}

select:focus, input:focus {
  outline: none;
  border-color: var(--primary-light);
  box-shadow: 0 0 0 3px rgba(121, 134, 203, 0.2);
}

button {
  padding: 12px 24px;
  border: none;
  border-radius: 8px;
  background: linear-gradient(135deg, var(--primary-medium) 0%, var(--accent-color) 100%);
  color: white;
  cursor: pointer;
  font-weight: 600;
  font-size: 1rem;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(123, 31, 162, 0.3);
}

button:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(123, 31, 162, 0.4);
}

button:disabled {
  background: #ccc;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

#slots {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-top: 15px;
  border: 1px dashed #ddd;
  padding: 20px;
  border-radius: 10px;
  min-height: 70px;
  align-items: center;
  background: var(--card-bg);
}

#slots button {
  margin: 0;
  padding: 10px 15px;
  border-radius: 8px;
  border: 0;
  font-size: 0.9rem;
}

#slots button:disabled {
  background: var(--error);
  opacity: 0.7;
}

#slots button:not(:disabled) {
  background: var(--success);
}

#slots button.selected {
  background: var(--accent-color);
  color: white;
  transform: scale(1.05);
  box-shadow: 0 4px 15px rgba(123, 31, 162, 0.4);
}

#slots button.pending {
  background: var(--warning);
  color: white;
  opacity: 0.8;
}

#slots button.pending:hover {
  background: #e68900;
}

.slot-checkbox {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  border: 2px solid #ddd;
  border-radius: 8px;
  background: white;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
}

.slot-checkbox:hover:not(.booked):not(.pending) {
  border-color: var(--primary-light);
  background: rgba(121, 134, 203, 0.1);
}

.slot-checkbox.selected {
  border-color: var(--accent-color);
  background: rgba(123, 31, 162, 0.15);
  box-shadow: 0 0 0 2px rgba(123, 31, 162, 0.3);
  transform: scale(1.02);
}

.slot-checkbox.selected.available {
  border-color: var(--accent-color);
  background: linear-gradient(135deg, rgba(123, 31, 162, 0.1), rgba(76, 175, 80, 0.1));
}

.slot-checkbox input[type="checkbox"] {
  width: auto;
  margin: 0;
}

/* Available slots - Green */
.slot-checkbox.available {
  border-color: var(--success);
  background: rgba(76, 175, 80, 0.1);
  position: relative;
}

.slot-checkbox.available::before {
  content: '✓';
  position: absolute;
  top: 2px;
  right: 2px;
  color: var(--success);
  font-weight: bold;
  font-size: 12px;
}

.slot-checkbox.available:hover {
  border-color: #2e7d32;
  background: rgba(76, 175, 80, 0.2);
}

/* Booked slots - Red */
.slot-checkbox.booked {
  border-color: var(--error);
  background: rgba(244, 67, 54, 0.2);
  opacity: 0.7;
  cursor: not-allowed;
  pointer-events: none;
  position: relative;
}

.slot-checkbox.booked::before {
  content: '✗';
  position: absolute;
  top: 2px;
  right: 2px;
  color: var(--error);
  font-weight: bold;
  font-size: 12px;
}

.slot-checkbox.booked:hover {
  border-color: #d32f2f;
  background: rgba(244, 67, 54, 0.25);
}

.slot-checkbox.booked input[type="checkbox"] {
  opacity: 0.3;
  cursor: not-allowed;
}

/* Pending slots - Yellow */
.slot-checkbox.pending {
  border-color: var(--warning);
  background: rgba(255, 152, 0, 0.2);
  opacity: 0.8;
  cursor: not-allowed;
  pointer-events: none;
  position: relative;
}

.slot-checkbox.pending::before {
  content: '⏳';
  position: absolute;
  top: 2px;
  right: 2px;
  color: var(--warning);
  font-size: 10px;
}

.slot-checkbox.pending:hover {
  border-color: #e68900;
  background: rgba(255, 152, 0, 0.25);
}

.slot-checkbox.pending input[type="checkbox"] {
  opacity: 0.3;
  cursor: not-allowed;
}

/* Status indicators */
.slot-checkbox::after {
  content: '';
  position: absolute;
  top: 4px;
  right: 4px;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  opacity: 0.8;
}

.slot-checkbox.available::after {
  background: var(--success);
}

.slot-checkbox.booked::after {
  background: var(--error);
}

.slot-checkbox.pending::after {
  background: var(--warning);
}

textarea {
  width: 100%;
  padding: 12px 15px;
  margin-top: 5px;
  border-radius: 8px;
  border: 1px solid #ddd;
  font-size: 1rem;
  transition: all 0.3s ease;
  background: white;
  font-family: inherit;
  resize: vertical;
}

textarea:focus {
  outline: none;
  border-color: var(--primary-light);
  box-shadow: 0 0 0 3px rgba(121, 134, 203, 0.2);
}

#booking-form {
  margin-top: 30px;
  display: none;
  padding: 25px;
  background: var(--card-bg);
  border-radius: var(--border-radius);
  border-left: 4px solid var(--accent-color);
}

/* Calendar styles */
#calendar {
  user-select: none;
  margin-top: 15px;
  border: 1px solid #e0e0e0;
  border-radius: var(--border-radius);
  padding: 20px;
  background: white;
}

.calendar-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.cal-title {
  font-size: 1.3rem;
  font-weight: 600;
  color: var(--primary-dark);
}

.cal-nav {
  display: flex;
  gap: 10px;
}

.cal-nav button {
  padding: 8px 12px;
  font-size: 1rem;
  background: var(--primary-medium);
}

.cal-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 8px;
}

.cal-weekday {
  text-align: center;
  font-weight: 600;
  color: var(--primary-dark);
  padding: 10px 0;
  border-bottom: 1px solid #e0e0e0;
}

.cal-day {
  padding: 12px;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  background: white;
  color: var(--text-dark);
  min-height: 50px;
  font-size: 1rem;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.cal-day:hover:not(.empty):not(.selected) {
  background: var(--primary-light);
  color: white;
}

.cal-day.empty {
  background: transparent;
  border: none;
  cursor: default;
}

.cal-day.today {
  border-color: var(--accent-color);
  background: rgba(123, 31, 162, 0.1);
}

.cal-day.selected {
  background: var(--accent-color);
  color: white;
  border-color: var(--accent-color);
}

#selected-date {
  margin-top: 15px;
  font-weight: 600;
  color: var(--primary-dark);
  text-align: center;
  padding: 10px;
  background: rgba(121, 134, 203, 0.1);
  border-radius: 8px;
}

.status-message {
  padding: 12px;
  border-radius: 8px;
  margin: 15px 0;
  text-align: center;
  font-weight: 500;
}

.status-info {
  background: rgba(33, 150, 243, 0.1);
  color: #1976d2;
}

.status-error {
  background: rgba(244, 67, 54, 0.1);
  color: #d32f2f;
}

/* Touch-friendly improvements */
@media (hover: none) and (pointer: coarse) {
  .slot-checkbox {
    min-height: 44px;
    min-width: 44px;
  }
  
  button, .nav-link, .cal-nav button {
    min-height: 44px;
    min-width: 44px;
  }
  
  input, select, textarea {
    min-height: 44px;
  }
}

/* Responsive design */
@media (max-width: 768px) {
  .container {
    padding: 0 15px;
    margin: 20px auto;
  }
  
  .card {
    padding: 20px;
    margin-bottom: 20px;
  }
  
  .title {
    font-size: 1.5rem;
  }
  
  .subtitle {
    font-size: 1rem;
  }
  
  .booking-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 15px;
  }
  
  .nav-link {
    padding: 6px 12px;
    font-size: 0.9rem;
  }
  
  /* Calendar responsive */
  .cal-grid {
    grid-template-columns: repeat(7, 1fr);
    gap: 4px;
  }
  
  .cal-day {
    padding: 6px 4px;
    font-size: 0.8rem;
    min-height: 35px;
  }
  
  .cal-weekday {
    font-size: 0.8rem;
    padding: 8px 0;
  }
  
  .cal-title {
    font-size: 1.1rem;
  }
  
  .cal-nav button {
    padding: 6px 10px;
    font-size: 0.9rem;
  }
  
  /* Slots responsive */
  .slot-checkbox {
    padding: 6px 10px;
    font-size: 0.9rem;
  }
  
  .slot-checkbox::before {
    font-size: 10px;
    top: 1px;
    right: 1px;
  }
  
  .slot-checkbox::after {
    width: 6px;
    height: 6px;
    top: 2px;
    right: 2px;
  }
  
  /* Form responsive */
  input, select, textarea {
    padding: 10px 12px;
    font-size: 0.9rem;
  }
  
  button {
    padding: 10px 20px;
    font-size: 0.9rem;
  }
  
  /* Status legend responsive */
  .status-legend {
    flex-direction: column;
    gap: 10px;
    align-items: flex-start;
  }
  
  header {
    flex-direction: column;
    gap: 15px;
    padding: 15px 5%;
  }
  
  .header-title {
    font-size: 1.3rem;
  }
  
  .user-nav {
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
  }
  
  .user-nav a {
    padding: 6px 12px;
    font-size: 0.9rem;
  }
}

@media (max-width: 480px) {
  .container {
    padding: 0 10px;
    margin: 15px auto;
  }
  
  .card {
    padding: 15px;
    margin-bottom: 15px;
  }
  
  .title {
    font-size: 1.3rem;
  }
  
  .subtitle {
    font-size: 0.9rem;
  }
  
  /* Calendar mobile */
  .cal-grid {
    gap: 2px;
  }
  
  .cal-day {
    padding: 4px 2px;
    font-size: 0.7rem;
    min-height: 30px;
  }
  
  .cal-weekday {
    font-size: 0.7rem;
    padding: 6px 0;
  }
  
  .cal-title {
    font-size: 1rem;
  }
  
  /* Slots mobile */
  .slot-checkbox {
    padding: 5px 8px;
    font-size: 0.8rem;
    flex-direction: column;
    text-align: center;
    gap: 4px;
  }
  
  .slot-checkbox input[type="checkbox"] {
    margin: 0;
  }
  
  /* Form mobile */
  input, select, textarea {
    padding: 8px 10px;
    font-size: 0.8rem;
  }
  
  button {
    padding: 8px 16px;
    font-size: 0.8rem;
  }
  
  /* Header mobile */
  .header-title {
    font-size: 1.1rem;
  }
  
  .user-nav {
    gap: 8px;
  }
  
  .user-nav a {
    padding: 5px 10px;
    font-size: 0.8rem;
  }
  
  /* Modal mobile */
  .modal {
    width: 95%;
    margin: 10px;
  }
  
  .modal-body {
    padding: 12px;
  }
  
  .modal-row {
    flex-direction: column;
    gap: 5px;
    padding: 6px 0;
  }
}
</style>
</head>
<body>

<header>

    <div class="header-title">Faculty Dashboard</div>
    <div class="user-nav">
        <a href="/">Home</a>
        <a href="/faculty/my_bookings">My Bookings</a>
        <a href="/logout">Logout</a>
    </div>
</header>

<div class="container">


<div class="card">
    <div class="booking-header">
        <h2 class="title">Place New Booking</h2>
        <a href="/faculty/my_bookings" class="nav-link">View My Bookings</a>
    </div>

    <!-- Step 1: Venue -->
    <label for="venue">Select Venue:</label>
    <select id="venue">
        <option value="">--Select Venue--</option>

        {% for v in venues %}
        <option value="{{ v }}">{{ v }}</option>
        {% endfor %}
    </select>



    <!-- Step 2: Date via Calendar -->
    <label for="calendar">Select Date:</label>
    <div id="calendar" class="calendar"></div>
    <div id="selected-date"></div>

    <!-- Step 3: Slots -->
    <div id="slots-container">
        <h3 class="subtitle">Available Time Slots</h3>
        
        <!-- Status Legend -->
        <div style="display: flex; gap: 20px; margin-bottom: 15px; padding: 10px; background: rgba(121, 134, 203, 0.05); border-radius: 8px; flex-wrap: wrap;">
            <div style="display: flex; align-items: center; gap: 8px;">
                <div style="width: 20px; height: 20px; border: 2px solid var(--success); border-radius: 4px; background: rgba(76, 175, 80, 0.1); position: relative;">
                    <span style="position: absolute; top: 1px; right: 1px; color: var(--success); font-size: 10px; font-weight: bold;">✓</span>
                </div>
                <span style="font-size: 0.9rem; color: var(--text-dark);">Available (Clickable)</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
                <div style="width: 20px; height: 20px; border: 2px solid var(--warning); border-radius: 4px; background: rgba(255, 152, 0, 0.2); position: relative;">
                    <span style="position: absolute; top: 1px; right: 1px; color: var(--warning); font-size: 8px;">⏳</span>
                </div>
                <span style="font-size: 0.9rem; color: var(--text-dark);">Pending Approval (Disabled)</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
                <div style="width: 20px; height: 20px; border: 2px solid var(--error); border-radius: 4px; background: rgba(244, 67, 54, 0.2); position: relative;">
                    <span style="position: absolute; top: 1px; right: 1px; color: var(--error); font-size: 10px; font-weight: bold;">✗</span>
                </div>
                <span style="font-size: 0.9rem; color: var(--text-dark);">Booked (Disabled)</span>
            </div>
        </div>
        
        <div id="slots" class="slots">
            <div class="status-message status-info">Please select a venue and date to view available slots</div>
        </div>
        <div id="selected-slots-info" style="display: none; margin-top: 15px; padding: 10px; background: rgba(123, 31, 162, 0.1); border-radius: 8px;">
            <strong>Selected Slots:</strong> <span id="selected-slots-list"></span>
        </div>
    </div>

    <!-- Step 4: Booking Form -->
    <form id="booking-form" method="POST" action="/faculty/book">
        <input type="hidden" name="venue" id="form-venue">
        <input type="hidden" name="date" id="form-date">
        <input type="hidden" name="slots" id="form-slots">

        <label for="event-name">Event Name:</label>
        <input type="text" id="event-name" name="event_name" required placeholder="Enter event name">

        <label for="num-people">Number of People:</label>
        <input type="number" id="num-people" name="num_people" required min="1" placeholder="Enter number of attendees">

        <div style="margin-top: 20px;">
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                <input type="checkbox" id="canteen-required" name="canteen_required" style="width: auto; margin: 0;">
                <span>Canteen Requirements (Optional)</span>
            </label>
            <div id="canteen-details" style="display: none; margin-top: 10px;">
                <label for="canteen-details-text">Canteen Details:</label>
                <textarea id="canteen-details-text" name="canteen_details" rows="3" placeholder="Please specify your canteen requirements..."></textarea>
            </div>
        </div>

        <button type="submit" id="submit-btn" disabled>Submit Booking Request</button>
    </form>
</div>


</div>

<script>
const classSlots = [
    "8:30-9:30",
    "9:30-10:30",
    "10:50-11:50",
    "11:50-12:50",
    "1:30-2:30",
    "2:30-3:30"
];
const venueSelect = document.getElementById("venue");

let selectedDate = ""; // yyyy-mm-dd
let selectedSlots = []; // Array of selected slots
const slotsContainer = document.getElementById("slots");
const bookingForm = document.getElementById("booking-form");
const formVenue = document.getElementById("form-venue");
const formDate = document.getElementById("form-date");
const formSlots = document.getElementById("form-slots");
const selectedSlotsInfo = document.getElementById("selected-slots-list");
const selectedSlotsContainer = document.getElementById("selected-slots-info");
const submitBtn = document.getElementById("submit-btn");
const canteenCheckbox = document.getElementById("canteen-required");
const canteenDetails = document.getElementById("canteen-details");

// Track selected slots
function updateSelectedSlots() {
    selectedSlots = Array.from(document.querySelectorAll('#slots input[type="checkbox"]:checked'))
        .map(checkbox => checkbox.value);
    
    formSlots.value = selectedSlots.join(',');
    formVenue.value = venueSelect.value; // Set the venue value
    formDate.value = selectedDate; // Set the date value
    
    if (selectedSlots.length > 0) {
        selectedSlotsInfo.textContent = selectedSlots.join(', ');
        selectedSlotsContainer.style.display = 'block';
        bookingForm.style.display = "block";
        submitBtn.disabled = false;
    } else {
        selectedSlotsContainer.style.display = 'none';
        bookingForm.style.display = "none";
        submitBtn.disabled = true;
    }
}

// Canteen checkbox handler
canteenCheckbox.addEventListener('change', function() {
    if (this.checked) {
        canteenDetails.style.display = 'block';
    } else {
        canteenDetails.style.display = 'none';
        document.getElementById('canteen-details-text').value = '';
    }
});

async function loadSlots() {
    const venue = venueSelect.value;
    const date = selectedDate;

    if (!venue || !date) {
        slotsContainer.innerHTML = '<div class="status-message status-info">Please select a venue and a date to view available slots.</div>';
        selectedSlotsContainer.style.display = 'none';
        bookingForm.style.display = 'none';
        return;
    }

    slotsContainer.innerHTML = '<div class="status-message status-info">Loading available slots...</div>';

    const formData = new FormData();
    formData.append('venue', venue);
    formData.append('date', date);

    let bookedSlots = [];
    let pendingSlots = [];

    try {
        const resp = await fetch('/faculty/booked_slots', { method: 'POST', body: formData });
        if (resp.ok) {
            const data = await resp.json();
            bookedSlots = data.booked || [];
            pendingSlots = data.pending || [];
        } else {
            slotsContainer.innerHTML = '<div class="status-message status-error">Failed to load slot availability. Please try again.</div>';
            return;
        }
    } catch (e) {
        slotsContainer.innerHTML = '<div class="status-message status-error">Network error. Please check your connection and try again.</div>';
        return;
    }

    // Clear previous slots
    slotsContainer.innerHTML = "";
    let availableCount = 0;

    classSlots.forEach(slot => {
        const isBooked = bookedSlots.includes(slot);
        const isPending = pendingSlots.includes(slot);
        const isUnavailable = isBooked || isPending; // Combined status for easier disabling

        const slotContainer = document.createElement("div");
        slotContainer.className = "slot-checkbox";

        if (isBooked) slotContainer.classList.add("booked");
        else if (isPending) slotContainer.classList.add("pending");
        else slotContainer.classList.add("available");

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.value = slot;
        checkbox.id = `slot-${slot.replace(/[:\-]/g, '')}`;
        checkbox.disabled = isUnavailable; // THIS correctly disables the checkbox

        // Create an element for the text content
        const slotText = document.createElement("span"); 
        slotText.textContent = slot;
        
        // Use the span instead of <label> for better control inside the flex container
        // If you must use <label>, then change slotText back to label, but the logic below is the key fix

        if (isBooked) {
            slotText.textContent += " (Booked)";
            slotText.style.color = "var(--error)";
            slotText.style.fontWeight = "600";
        } else if (isPending) {
            slotText.textContent += " (Pending)";
            slotText.style.color = "var(--warning)";
            slotText.style.fontWeight = "600";
        } else {
            slotText.style.color = "var(--success)";
            slotText.style.fontWeight = "600";
        }

        slotContainer.appendChild(checkbox);
        slotContainer.appendChild(slotText); // Append span element

        // Only attach listeners to available slots
        if (!isUnavailable) {
            availableCount++;

            // Add listener to the WHOLE container for better UX
            slotContainer.addEventListener('click', (e) => {
                // Prevent toggling if the click was already on the checkbox itself to avoid double-toggle
                if (e.target !== checkbox) {
                    checkbox.checked = !checkbox.checked;
                }
                slotContainer.classList.toggle('selected', checkbox.checked);
                updateSelectedSlots();
            });

            // Add listener to the checkbox to handle direct clicks on it
            checkbox.addEventListener("change", (e) => {
                slotContainer.classList.toggle('selected', e.target.checked);
                updateSelectedSlots();
            });
        } else {
            // For disabled slots, add a visual indicator and prevent interaction
            slotContainer.style.pointerEvents = 'none';
            slotContainer.title = isBooked ? 'This slot is already booked' : 'This slot is pending approval';
        }

        slotsContainer.appendChild(slotContainer);
    });

    if (availableCount === 0) {
        slotsContainer.innerHTML = '<div class="status-message status-info">No available slots for the selected date. Please choose another date.</div>';
    }

    // Reset selection
    selectedSlots = [];
    updateSelectedSlots();
}
venueSelect.addEventListener("change", loadSlots);

// Calendar
const calendarEl = document.getElementById('calendar');
const selectedDateLabel = document.getElementById('selected-date');
const monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];

function pad2(n){ return n < 10 ? '0'+n : ''+n; }
function formatDateYmd(d){ return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`; }

function buildCalendarHeader(state){
    const header = document.createElement('div');
    header.className = 'calendar-header';

    const prev = document.createElement('button');
    prev.textContent = '‹';
    prev.className = 'cal-nav-prev';
    prev.onclick = () => { state.month--; if(state.month < 0){ state.month=11; state.year--; } renderCalendar(state); };

    const next = document.createElement('button');
    next.textContent = '›';
    next.className = 'cal-nav-next';
    next.onclick = () => { state.month++; if(state.month>11){ state.month=0; state.year++; } renderCalendar(state); };

    const title = document.createElement('div');
    title.className = 'cal-title';
    title.textContent = `${monthNames[state.month]} ${state.year}`;

    const nav = document.createElement('div'); nav.className='cal-nav';
    nav.appendChild(prev); nav.appendChild(next);

    header.appendChild(title); header.appendChild(nav);
    return header;
}

function buildCalendarGrid(state){
    const grid = document.createElement('div');
    grid.className = 'cal-grid';

    ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].forEach(w=>{
        const wd = document.createElement('div');
        wd.className='cal-weekday'; wd.textContent=w; grid.appendChild(wd);
    });

    const firstDay = new Date(state.year, state.month, 1);
    const startDow = firstDay.getDay();
    const daysInMonth = new Date(state.year, state.month+1, 0).getDate();

    for(let i=0;i<startDow;i++){ const empty = document.createElement('div'); empty.className='cal-day empty'; grid.appendChild(empty); }

    const todayYmd = formatDateYmd(new Date());
    for(let d=1;d<=daysInMonth;d++){
        const cell = document.createElement('button');
        cell.className='cal-day'; cell.textContent=d;
        const thisDate = new Date(state.year, state.month, d);
        const ymd = formatDateYmd(thisDate);

        if(ymd===todayYmd) cell.classList.add('today');
        if(selectedDate===ymd) cell.classList.add('selected');

        cell.onclick=()=>{
            selectedDate=ymd;
            formDate.value=ymd;
            selectedDateLabel.textContent=`Selected date: ${ymd}`;
            renderCalendar(state);
            loadSlots();
        };

        grid.appendChild(cell);
    }
    return grid;
}

function renderCalendar(state){
    calendarEl.innerHTML='';
    calendarEl.appendChild(buildCalendarHeader(state));
    calendarEl.appendChild(buildCalendarGrid(state));
}

// Initialize
const now = new Date();
const calendarState = { year: now.getFullYear(), month: now.getMonth() };
renderCalendar(calendarState);

selectedDate = formatDateYmd(now);
formDate.value = selectedDate;
selectedDateLabel.textContent = `Selected date: ${selectedDate}`;
  
// Auto-select first venue
if(venueSelect && venueSelect.options.length>1 && !venueSelect.value){
    venueSelect.selectedIndex=1;
    loadSlots();
}
</script>


</body>
</html>


