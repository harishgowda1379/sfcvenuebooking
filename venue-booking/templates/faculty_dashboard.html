<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Faculty Dashboard - College Venue Booking</title>
<style>

:root {
  --primary-dark: #1a237e; /* Dark blue */
  --primary-medium: #303f9f; /* Medium blue */
  --primary-light: #7986cb; /* Light blue */
  --accent-color: #7b1fa2; /* Purple accent */
  --accent-light: #9c27b0; /* Light purple */
  --text-dark: #212121;
  --text-light: #757575;
  --background: #ffffff;
  --card-bg: #f8f9fa;
  --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  --border-radius: 12px;
  --success: #4caf50;
  --warning: #ff9800;
  --error: #f44336;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
  color: var(--text-dark);
  line-height: 1.6;
  min-height: 100vh;
}

header {
  background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-medium) 100%);
  color: white;
  padding: 16px 5%;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.header-title {
  font-size: 1.5rem;
  font-weight: 600;
  letter-spacing: 0.5px;
}

.user-nav {
  display: flex;
  gap: 20px;
  align-items: center;
}

.user-nav a {
  color: white;
  text-decoration: none;
  font-weight: 500;
  padding: 8px 16px;
  border-radius: 6px;
  transition: all 0.3s ease;
  position: relative;
}

.user-nav a:hover {
  background: rgba(255, 255, 255, 0.15);
}

.user-nav a::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 50%;
  width: 0;
  height: 2px;
  background: white;
  transition: all 0.3s ease;
  transform: translateX(-50%);
}

.user-nav a:hover::after {
  width: 70%;
}

.container {
  max-width: 1100px;
  margin: 30px auto;
  padding: 0 20px;
}

.card {
  background: var(--background);
  padding: 30px;
  border-radius: var(--border-radius);
  box-shadow: var(--shadow);
  margin-bottom: 30px;
  border: 1px solid rgba(0, 0, 0, 0.05);
}

.title {
  font-size: 1.8rem;
  color: var(--primary-dark);
  margin-bottom: 20px;
  font-weight: 600;
  text-align: center;
}

.subtitle {
  font-size: 1.2rem;
  color: var(--primary-medium);
  margin: 20px 0 10px;
  font-weight: 600;
}

.booking-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
  flex-wrap: wrap;
  gap: 15px;
}

.nav-link {
  color: var(--accent-color);
  text-decoration: none;
  font-weight: 600;
  padding: 8px 16px;
  border-radius: 6px;
  border: 1px solid var(--accent-light);
  transition: all 0.3s ease;
}

.nav-link:hover {
  background: var(--accent-color);
  color: white;
}

label {
  display: block;
  margin-top: 20px;
  margin-bottom: 8px;
  font-weight: 600;
  color: var(--text-dark);
}

select, input {
  width: 100%;
  padding: 12px 15px;
  margin-top: 5px;
  border-radius: 8px;
  border: 1px solid #ddd;
  font-size: 1rem;
  transition: all 0.3s ease;
  background: white;
}

select:focus, input:focus {
  outline: none;
  border-color: var(--primary-light);
  box-shadow: 0 0 0 3px rgba(121, 134, 203, 0.2);
}

button {
  padding: 12px 24px;
  border: none;
  border-radius: 8px;
  background: linear-gradient(135deg, var(--primary-medium) 0%, var(--accent-color) 100%);
  color: white;
  cursor: pointer;
  font-weight: 600;
  font-size: 1rem;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(123, 31, 162, 0.3);
}

button:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(123, 31, 162, 0.4);
}

button:disabled {
  background: #ccc;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

#slots {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-top: 15px;
  border: 1px dashed #ddd;
  padding: 20px;
  border-radius: 10px;
  min-height: 70px;
  align-items: center;
  background: var(--card-bg);
}

#slots button {
  margin: 0;
  padding: 10px 15px;
  border-radius: 8px;
  border: 0;
  font-size: 0.9rem;
}

#slots button:disabled {
  background: var(--error);
  opacity: 0.7;
}

#slots button:not(:disabled) {
  background: var(--success);
}

#slots button.selected {
  background: var(--accent-color);
  color: white;
  transform: scale(1.05);
  box-shadow: 0 4px 15px rgba(123, 31, 162, 0.4);
}

#slots button.pending {
  background: var(--warning);
  color: white;
  opacity: 0.8;
}

#slots button.pending:hover {
  background: #e68900;
}

.slot-checkbox {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  border: 2px solid #ddd;
  border-radius: 8px;
  background: white;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
}

.slot-checkbox:hover:not(.booked):not(.pending) {
  border-color: var(--primary-light);
  background: rgba(121, 134, 203, 0.1);
}

.slot-checkbox.selected {
  border-color: var(--accent-color);
  background: rgba(123, 31, 162, 0.15);
  box-shadow: 0 0 0 2px rgba(123, 31, 162, 0.3);
  transform: scale(1.02);
}

.slot-checkbox.selected.available {
  border-color: var(--accent-color);
  background: linear-gradient(135deg, rgba(123, 31, 162, 0.1), rgba(76, 175, 80, 0.1));
}

.slot-checkbox input[type="checkbox"] {
  width: auto;
  margin: 0;
}

/* Available slots - Green */
.slot-checkbox.available {
  border-color: var(--success);
  background: rgba(76, 175, 80, 0.1);
}

.slot-checkbox.available:hover {
  border-color: #2e7d32;
  background: rgba(76, 175, 80, 0.2);
}

/* Booked slots - Red */
.slot-checkbox.booked {
  border-color: var(--error);
  background: rgba(244, 67, 54, 0.1);
  opacity: 0.7;
  cursor: not-allowed;
}

.slot-checkbox.booked:hover {
  border-color: #d32f2f;
  background: rgba(244, 67, 54, 0.15);
}

/* Pending slots - Yellow */
.slot-checkbox.pending {
  border-color: var(--warning);
  background: rgba(255, 152, 0, 0.1);
  opacity: 0.8;
  cursor: not-allowed;
}

.slot-checkbox.pending:hover {
  border-color: #e68900;
  background: rgba(255, 152, 0, 0.15);
}

/* Status indicators */
.slot-checkbox::after {
  content: '';
  position: absolute;
  top: 4px;
  right: 4px;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  opacity: 0.8;
}

.slot-checkbox.available::after {
  background: var(--success);
}

.slot-checkbox.booked::after {
  background: var(--error);
}

.slot-checkbox.pending::after {
  background: var(--warning);
}

textarea {
  width: 100%;
  padding: 12px 15px;
  margin-top: 5px;
  border-radius: 8px;
  border: 1px solid #ddd;
  font-size: 1rem;
  transition: all 0.3s ease;
  background: white;
  font-family: inherit;
  resize: vertical;
}

textarea:focus {
  outline: none;
  border-color: var(--primary-light);
  box-shadow: 0 0 0 3px rgba(121, 134, 203, 0.2);
}

#booking-form {
  margin-top: 30px;
  display: none;
  padding: 25px;
  background: var(--card-bg);
  border-radius: var(--border-radius);
  border-left: 4px solid var(--accent-color);
}

/* Calendar styles */
#calendar {
  user-select: none;
  margin-top: 15px;
  border: 1px solid #e0e0e0;
  border-radius: var(--border-radius);
  padding: 20px;
  background: white;
}

.calendar-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.cal-title {
  font-size: 1.3rem;
  font-weight: 600;
  color: var(--primary-dark);
}

.cal-nav {
  display: flex;
  gap: 10px;
}

.cal-nav button {
  padding: 8px 12px;
  font-size: 1rem;
  background: var(--primary-medium);
}

.cal-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 8px;
}

.cal-weekday {
  text-align: center;
  font-weight: 600;
  color: var(--primary-dark);
  padding: 10px 0;
  border-bottom: 1px solid #e0e0e0;
}

.cal-day {
  padding: 12px;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  background: white;
  color: var(--text-dark);
  min-height: 50px;
  font-size: 1rem;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.cal-day:hover:not(.empty):not(.selected) {
  background: var(--primary-light);
  color: white;
}

.cal-day.empty {
  background: transparent;
  border: none;
  cursor: default;
}

.cal-day.today {
  border-color: var(--accent-color);
  background: rgba(123, 31, 162, 0.1);
}

.cal-day.selected {
  background: var(--accent-color);
  color: white;
  border-color: var(--accent-color);
}

#selected-date {
  margin-top: 15px;
  font-weight: 600;
  color: var(--primary-dark);
  text-align: center;
  padding: 10px;
  background: rgba(121, 134, 203, 0.1);
  border-radius: 8px;
}

.status-message {
  padding: 12px;
  border-radius: 8px;
  margin: 15px 0;
  text-align: center;
  font-weight: 500;
}

.status-info {
  background: rgba(33, 150, 243, 0.1);
  color: #1976d2;
}

.status-error {
  background: rgba(244, 67, 54, 0.1);
  color: #d32f2f;
}

/* Responsive design */
@media (max-width: 768px) {
  .container {
    padding: 0 15px;
  }
  
  .card {
    padding: 20px;
  }
  
  .booking-header {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .cal-grid {
    grid-template-columns: repeat(7, 1fr);
    gap: 5px;
  }
  
  .cal-day {
    padding: 8px 5px;
    font-size: 0.9rem;
    min-height: 40px;
  }
  
  header {
    flex-direction: column;
    gap: 15px;
    padding: 15px 5%;
  }
  
  .user-nav {
    justify-content: center;
    flex-wrap: wrap;
  }
}
</style>
</head>
<body>

<header>

    <div class="header-title">Faculty Dashboard</div>
    <div class="user-nav">
        <a href="/">Home</a>
        <a href="/faculty/my_bookings">My Bookings</a>
        <a href="/logout">Logout</a>
    </div>
</header>

<div class="container">


<div class="card">
    <div class="booking-header">
        <h2 class="title">Place New Booking</h2>
        <a href="/faculty/my_bookings" class="nav-link">View My Bookings</a>
    </div>

    <!-- Step 1: Venue -->
    <label for="venue">Select Venue:</label>
    <select id="venue">
        <option value="">--Select Venue--</option>

        {% for v in venues %}
        <option value="{{ v }}">{{ v }}</option>
        {% endfor %}
    </select>



    <!-- Step 2: Date via Calendar -->
    <label for="calendar">Select Date:</label>
    <div id="calendar" class="calendar"></div>
    <div id="selected-date"></div>

    <!-- Step 3: Slots -->
    <div id="slots-container">
        <h3 class="subtitle">Available Time Slots</h3>
        
        <!-- Status Legend -->
        <div style="display: flex; gap: 20px; margin-bottom: 15px; padding: 10px; background: rgba(121, 134, 203, 0.05); border-radius: 8px; flex-wrap: wrap;">
            <div style="display: flex; align-items: center; gap: 8px;">
                <div style="width: 12px; height: 12px; border-radius: 50%; background: var(--success);"></div>
                <span style="font-size: 0.9rem; color: var(--text-dark);">Available</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
                <div style="width: 12px; height: 12px; border-radius: 50%; background: var(--warning);"></div>
                <span style="font-size: 0.9rem; color: var(--text-dark);">Pending Approval</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
                <div style="width: 12px; height: 12px; border-radius: 50%; background: var(--error);"></div>
                <span style="font-size: 0.9rem; color: var(--text-dark);">Booked</span>
            </div>
        </div>
        
        <div id="slots" class="slots">
            <div class="status-message status-info">Please select a venue and date to view available slots</div>
        </div>
        <div id="selected-slots-info" style="display: none; margin-top: 15px; padding: 10px; background: rgba(123, 31, 162, 0.1); border-radius: 8px;">
            <strong>Selected Slots:</strong> <span id="selected-slots-list"></span>
        </div>
    </div>

    <!-- Step 4: Booking Form -->
    <form id="booking-form" method="POST" action="/faculty/book">
        <input type="hidden" name="venue" id="form-venue">
        <input type="hidden" name="date" id="form-date">
        <input type="hidden" name="slots" id="form-slots">

        <label for="event-name">Event Name:</label>
        <input type="text" id="event-name" name="event_name" required placeholder="Enter event name">

        <label for="num-people">Number of People:</label>
        <input type="number" id="num-people" name="num_people" required min="1" placeholder="Enter number of attendees">

        <div style="margin-top: 20px;">
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                <input type="checkbox" id="canteen-required" name="canteen_required" style="width: auto; margin: 0;">
                <span>Canteen Requirements (Optional)</span>
            </label>
            <div id="canteen-details" style="display: none; margin-top: 10px;">
                <label for="canteen-details-text">Canteen Details:</label>
                <textarea id="canteen-details-text" name="canteen_details" rows="3" placeholder="Please specify your canteen requirements..."></textarea>
            </div>
        </div>

        <button type="submit" id="submit-btn" disabled>Submit Booking Request</button>
    </form>
</div>


</div>

<script>


const classSlots = [
    "8:30-9:30",
    "9:30-10:30",
    "10:50-11:50",
    "11:50-12:50",
    "1:30-2:30",
    "2:30-3:30"
];
const venueSelect = document.getElementById("venue");

let selectedDate = ""; // yyyy-mm-dd
let selectedSlots = []; // Array of selected slots
const slotsContainer = document.getElementById("slots");
const bookingForm = document.getElementById("booking-form");
const formVenue = document.getElementById("form-venue");
const formDate = document.getElementById("form-date");
const formSlots = document.getElementById("form-slots");
const selectedSlotsInfo = document.getElementById("selected-slots-list");
const selectedSlotsContainer = document.getElementById("selected-slots-info");
const submitBtn = document.getElementById("submit-btn");
const canteenCheckbox = document.getElementById("canteen-required");
const canteenDetails = document.getElementById("canteen-details");

// Track selected slots
function updateSelectedSlots() {
    selectedSlots = Array.from(document.querySelectorAll('#slots input[type="checkbox"]:checked'))
        .map(checkbox => checkbox.value);
    
    formSlots.value = selectedSlots.join(',');
    
    if (selectedSlots.length > 0) {
        selectedSlotsInfo.textContent = selectedSlots.join(', ');
        selectedSlotsContainer.style.display = 'block';
        bookingForm.style.display = "block";
        submitBtn.disabled = false;
    } else {
        selectedSlotsContainer.style.display = 'none';
        bookingForm.style.display = "none";
        submitBtn.disabled = true;
    }
}

// Canteen checkbox handler
canteenCheckbox.addEventListener('change', function() {
    if (this.checked) {
        canteenDetails.style.display = 'block';
    } else {
        canteenDetails.style.display = 'none';
        document.getElementById('canteen-details-text').value = '';
    }
});

async function loadSlots() {
    const venue = venueSelect.value;
    const date = selectedDate;
    
    if(!venue || !date) {
        slotsContainer.innerHTML = '<div class="status-message status-info">Please select a venue and a date to view available slots.</div>';
        selectedSlotsContainer.style.display = 'none';
        bookingForm.style.display = 'none';
        return;
    }

    // Show loading state
    slotsContainer.innerHTML = '<div class="status-message status-info">Loading available slots...</div>';

    const formData = new FormData();
    formData.append('venue', venue);
    formData.append('date', date);
    let bookedSlots = [];
    let pendingSlots = [];
    
    try {
        const resp = await fetch('/faculty/booked_slots', { method: 'POST', body: formData });
        if (resp.ok) {
            const data = await resp.json();
            bookedSlots = data.booked || [];
            pendingSlots = data.pending || [];
        } else {
            console.warn('Failed to load booked slots', resp.status);
            slotsContainer.innerHTML = '<div class="status-message status-error">Failed to load slot availability. Please try again.</div>';
            return;
        }
    } catch (e) {
        console.error('Error fetching booked slots', e);
        slotsContainer.innerHTML = '<div class="status-message status-error">Network error. Please check your connection and try again.</div>';
        return;
    }

    slotsContainer.innerHTML = "";
    let availableCount = 0;
    
    classSlots.forEach(slot => {
        const isBooked = bookedSlots.includes(slot);
        const isPending = pendingSlots.includes(slot);
        
        // Create checkbox container
        const slotContainer = document.createElement("div");
        slotContainer.className = "slot-checkbox";
        
        // Apply status classes and colors
        if (isBooked) {
            slotContainer.classList.add("booked");
        } else if (isPending) {
            slotContainer.classList.add("pending");
        } else {
            slotContainer.classList.add("available");
        }
        
        // Create checkbox
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.value = slot;
        checkbox.id = `slot-${slot.replace(/[:\-]/g, '')}`;
        checkbox.disabled = isBooked || isPending;
        
        // Create label
        const label = document.createElement("label");
        label.htmlFor = checkbox.id;
        label.textContent = slot;
        if (isBooked) {
            label.textContent += " (Booked)";
            label.style.color = "var(--error)";
        } else if (isPending) {
            label.textContent += " (Pending)";
            label.style.color = "var(--warning)";
        } else {
            label.style.color = "var(--success)";
            label.style.fontWeight = "600";
        }
        
        slotContainer.appendChild(checkbox);
        slotContainer.appendChild(label);
        
        if (!isBooked && !isPending) {
            availableCount++;
            checkbox.addEventListener("change", updateSelectedSlots);
        }
        
        slotsContainer.appendChild(slotContainer);
    });
    
    if (availableCount === 0) {
        slotsContainer.innerHTML = '<div class="status-message status-info">No available slots for the selected date. Please choose another date.</div>';
    }
    
    // Reset form when slots change
    selectedSlots = [];
    updateSelectedSlots();
}

venueSelect.addEventListener("change", loadSlots);



// Calendar rendering
const calendarEl = document.getElementById('calendar');
const selectedDateLabel = document.getElementById('selected-date');
const monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];

function pad2(n){ return n < 10 ? '0'+n : ''+n; }

function formatDateYmd(d){
    const y = d.getFullYear();
    const m = pad2(d.getMonth()+1);
    const day = pad2(d.getDate());
    return `${y}-${m}-${day}`;
}

function buildCalendarHeader(state){
    const header = document.createElement('div');
    header.className = 'calendar-header';

    const prev = document.createElement('button');
    prev.textContent = '‹';
    prev.className = 'cal-nav-prev';
    prev.onclick = () => {
        state.month -= 1;
        if(state.month < 0){ state.month = 11; state.year -= 1; }
        renderCalendar(state);
    };

    const title = document.createElement('div');
    title.textContent = `${monthNames[state.month]} ${state.year}`;
    title.className = 'cal-title';

    const next = document.createElement('button');
    next.textContent = '›';
    next.className = 'cal-nav-next';
    next.onclick = () => {
        state.month += 1;
        if(state.month > 11){ state.month = 0; state.year += 1; }
        renderCalendar(state);
    };

    const navContainer = document.createElement('div');
    navContainer.className = 'cal-nav';
    navContainer.appendChild(prev);
    navContainer.appendChild(next);

    header.appendChild(title);
    header.appendChild(navContainer);
    return header;
}

function buildCalendarGrid(state){
    const grid = document.createElement('div');
    grid.className = 'cal-grid';

    const weekdays = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
    weekdays.forEach(w => {
        const el = document.createElement('div');
        el.textContent = w;
        el.className = 'cal-weekday';
        grid.appendChild(el);
    });

    const firstDay = new Date(state.year, state.month, 1);
    const startDow = firstDay.getDay();
    const daysInMonth = new Date(state.year, state.month+1, 0).getDate();

    for(let i=0;i<startDow;i++){
        const empty = document.createElement('div');
        empty.className = 'cal-day empty';
        grid.appendChild(empty);
    }

    const todayYmd = formatDateYmd(new Date());
    for(let d=1; d<=daysInMonth; d++){
        const cell = document.createElement('button');
        cell.textContent = d;
        cell.className = 'cal-day';
        const thisDate = new Date(state.year, state.month, d);
        const ymd = formatDateYmd(thisDate);

        if(ymd === todayYmd){ cell.classList.add('today'); }
        if(selectedDate === ymd){ cell.classList.add('selected'); }

        cell.onclick = () => {
            selectedDate = ymd;
            formDate.value = ymd;
            renderCalendar(state);
            loadSlots();
            selectedDateLabel.textContent = `Selected date: ${ymd}`;
        };
        grid.appendChild(cell);
    }
    return grid;
}

function renderCalendar(state){
    calendarEl.innerHTML = '';
    calendarEl.appendChild(buildCalendarHeader(state));
    calendarEl.appendChild(buildCalendarGrid(state));
}

// Initialize calendar to current month
const now = new Date();
const calendarState = { year: now.getFullYear(), month: now.getMonth() };
renderCalendar(calendarState);

// Set today as default selected date
selectedDate = formatDateYmd(now);
formDate.value = selectedDate;
selectedDateLabel.textContent = `Selected date: ${selectedDate}`;

// If the user hasn't picked a venue, auto-select the first actual option
if (venueSelect && venueSelect.options && venueSelect.options.length > 1 && !venueSelect.value) {
    venueSelect.selectedIndex = 1; // first non-placeholder
    loadSlots();
}
</script>

</body>
</html>


